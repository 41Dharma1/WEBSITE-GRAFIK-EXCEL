<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overview Pallet Mover</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="main-container">
        <header class="dashboard-header">
            <div class="header-top">
                <h1>ðŸ“Š Overview Reach Truck </h1>
                <div id="loading" class="badge-live">SINKRONISASI...</div>
            </div>
            
            <nav class="navigation-menu category-nav">
                <a href="../index.html" class="btn btn-main">PALLET MOVER</a>
                <a href="./ReachTruck/Reach_Truck.html" class="btn btn-main active">REACH TRUCK</a>
                <a href="../Karton_Packaging/Karton_Packaging.html" class="btn btn-main">KARTON</a>
                <a href="../Unloading/Unloading.html" class="btn btn-main">UNLOADING</a>
            </nav>

            <nav class="navigation-menu sub-nav">
                <a href="./Reach_Truck.html" class="btn active">OVERVIEW RT</a>
                <a href="./Banyak Put-Away & Retreive Per-Jam.html" class="btn">PER JAM RT</a>
                <a href="./Banyak Put-Away  & Retrieve Per-Slock.html" class="btn">PER SLOCK RT</a>
                <a href="./Banyak Put-Away & Retrieve Per-Bin.html" class="btn">PER BIN RT</a>
                <a href="./Banyak Put-Away & Retrieve Per activitas .html" class="btn">PER ACTIVITAS RT</a>
            </nav>
        </header>

        <div class="stats-row">
            <div class="stat-card">
                <span class="stat-label">Total Quantity</span>
                <h2 id="total-qty" class="stat-value">0</h2>
            </div>
            <div class="stat-card">
                <span class="stat-label">Total Lokasi</span>
                <h2 id="total-loc" class="stat-value">0</h2>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-wrapper">
                <canvas id="mainBarChart"></canvas>
            </div>
        </div>
    </div>
    <script>
        // --- 1. SETTING KHUSUS HALAMAN INI ---
        const CONFIG = {
            csvUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTjmjtHeut2HUwGNNG3yQ9V4q9o4Vjv77SJOGWEoZTY_zeo4kTJyVzhVhMIi--R2ZfllhxatcKYDpTQ/pub?gid=826802225&single=true&output=csv=csv",
            chartType: 'bar', // Bisa ganti 'line' atau 'pie'
            barColor: '#4318ff', // Warna batang
            chartLabel: 'Total Quantity Per Jam' // Judul saat hover
        };

        async function updateDashboard() {
            const loadingEl = document.getElementById('loading');
            
            try {
                const response = await fetch(CONFIG.csvUrl);
                const csvText = await response.text();
                
                // Pisahkan baris & hapus baris kosong (slice(1) untuk buang Header)
                const rows = csvText.split(/\r?\n/).filter(row => row.trim() !== "").slice(1); 
                
                let dataMap = {};
                let totalQtySum = 0;

                rows.forEach(row => {
                    // Split kolom dengan aman (handle tanda kutip di CSV)
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    
                    if (cols.length >= 2) {
                        const label = cols[8]?.replace(/"/g, "").trim(); // Kolom A (Jam)
                        const qty = parseFloat(cols[9]?.replace(/"/g, "")) || 0; // Kolom B (Qty)

                        if (label) {
                            dataMap[label] = (dataMap[label] || 0) + qty;
                            totalQtySum += qty;
                        }
                    }
                });

                // Update UI Angka
                document.getElementById('total-qty').innerText = totalQtySum.toLocaleString('id-ID');
                document.getElementById('total-loc').innerText = Object.keys(dataMap).length;
                
                if (loadingEl) loadingEl.style.display = 'none';

                // Siapkan Data Grafik
                const labels = Object.keys(dataMap);
                const values = Object.values(dataMap);

                renderChart(labels, values);

            } catch (error) {
                console.error("Fetch Error:", error);
                if (loadingEl) loadingEl.innerText = "Gagal Memuat Data Sheet!";
            }
        }

        function renderChart(labels, values) {
            const ctx = document.getElementById('mainBarChart').getContext('2d');
            
            // Hapus chart lama jika ada agar tidak tumpang tindih
            const existingChart = Chart.getChart("mainBarChart");
            if (existingChart) existingChart.destroy();

            new Chart(ctx, {
                type: CONFIG.chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: CONFIG.chartLabel,
                        data: values,
                        backgroundColor: CONFIG.barColor,
                        borderRadius: 8,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false } // Sembunyikan legend box
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { color: '#f0f0f0' },
                            ticks: { font: { size: 11 } }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }

        // Jalankan saat halaman siap
        document.addEventListener('DOMContentLoaded', updateDashboard);
    </script>
</body>
</html>
